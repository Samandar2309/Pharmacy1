#!/usr/bin/env python
"""
OTP Testing Guide - Step by Step

Run all these commands in order to test registration flow
"""

print("""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           DORIXONA - OTP TESTING GUIDE                         â•‘
â•‘           Sana: 12.02.2026                                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”§ SETUP - Terminal'lar
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Terminal 1 (Backend):
  cd d:\\Dorixona
  python manage.py runserver

Terminal 2 (Frontend):
  cd d:\\Dorixona\\frontend_test
  npm run dev

Terminal 3 (Django Shell):
  cd d:\\Dorixona
  python manage.py shell

ğŸŒ Browser
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

http://localhost:3000/register

ğŸ“‹ TEST STEPS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

STEP 1: Browser'da Register Page
  1. http://localhost:3000/register
  2. Form to'ldiring:
     - Ism: Ali
     - Familiya: Valiyev
     - Telefon: +998901234567
     - Parol: password123
  3. "Ro'yxatdan o'tish" bosing
  
  âœ… Expected: OTP Page ko'rinadi
  âš ï¸ Backend logs'da: "SMS DEBUG MODE - Simulated SMS"

STEP 2: Django Shell'da OTP kodni olish
  Terminal 3'da:
  
  python manage.py shell
  
  >>> from users.models import SMSVerification
  >>> sms = SMSVerification.objects.filter(
  ...   phone_number="+998901234567"
  ... ).last()
  >>> print(f"OTP Code: {sms.code}")
  >>> print(f"Expires: {sms.expires_at}")

STEP 3: OTP'ni kiritish
  1. OTP Page'da 4 ta input ko'rinadi
  2. OTP kodni (masalan: 1234) kiritish:
     - Input 1'ga: 1
     - Auto-focus Input 2'ga
     - Input 2'ga: 2
     - Auto-focus Input 3'ga
     - Input 3'ga: 3
     - Auto-focus Input 4'ga
     - Input 4'ga: 4
  
  âœ… Expected: 4 xonali kod kiritiladi

STEP 4: Tasdiqlash
  1. "Tasdiqlash" tugmasini bosing
  2. Backend logs'da tekshirish:
     [12/Feb/2026 ...] "POST /api/v2/users/verify/ HTTP/1.1" 200
  
  âœ… Expected: 
     - "Ro'yxatdan o'ttingiz!" toast
     - 2 sekunddan Home page'ga redirect
     - Browser Console'da token ko'rinadi

STEP 5: Login Test
  1. http://localhost:3000/login
  2. Kiritish:
     - Telefon: +998901234567
     - Parol: password123
  3. "Kirish" bosing
  
  âœ… Expected:
     - "Xush kelibsiz!" toast
     - Home page
     - Navbar user menu ko'rinadi

ğŸ“Š DEBUGGING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Agar OTP Page ko'rinmasa:
  1. Browser Console (F12) tekshiring
  2. Network tab'da Register request response'ni ko'ring
  3. Backend logs'da error bo'lsa, ko'ring

Agar OTP kodi kelmaÑĞ°:
  1. Django Shell'da user mavjudligini tekshiring:
     >>> from users.models import User
     >>> User.objects.filter(phone_number="+998901234567").exists()
  2. SMS logs:
     Backend terminal'da "SMS DEBUG MODE" logni ko'ring

Agar Tasdiqlash bo'lmasa:
  1. OTP kodi to'g'rimi, tekshiring (expires qilganmi?)
  2. Frontend Console errors'ni ko'ring
  3. Backend logs'da 404 bo'lsa, endpoint problem

âœ… EXPECTED LOGS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Register:
  [12/Feb/2026 ...] "POST /api/v2/users/register/ HTTP/1.1" 200 42
  Backend logs: SMS DEBUG MODE - Simulated SMS to +998901234567

OTP Verify:
  [12/Feb/2026 ...] "POST /api/v2/users/verify/ HTTP/1.1" 200 658

Login:
  [12/Feb/2026 ...] "POST /api/v2/users/login/ HTTP/1.1" 200 658

ğŸ” PRODUCTION CHECKS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Production'da SMS_DEBUG ni FALSE qiling:
  .env:
    SMS_DEBUG=False
    DEVSMS_TOKEN=your_real_token

âœ… SUCCESS INDICATORS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… Register Form ko'rinadi
âœ… API response 200 (SMS yuborildi)
âœ… OTP Page ko'rinadi (4 inputs)
âœ… Auto-focus ishlaydi
âœ… OTP kodi Django Shell'da ko'rinadi
âœ… "Tasdiqlash" success javob beradi
âœ… Token localStorage'ga saqlanadi
âœ… Home page'ga redirect
âœ… Login ishlaydi
âœ… Navbar user menu ko'rinadi

ğŸš€ READY FOR PRODUCTION!

""")
